import{r as d,j as s}from"./app-74bb848f.js";import{n as g,K as H}from"./AuthenticatedLayout-0ad038d2.js";import"./MetronicSplashScreen-01c28a04.js";import"./MenuComponent-84cafbd8.js";import{T as ne,a as J}from"./Tabs-0deeaaaa.js";const de=({metadata:r,data:a,setData:f})=>{var O,G;console.log("ProductMetaData metadata",r);const[Q,U]=d.useState([]),[$,M]=d.useState([]),[x,B]=d.useState([]),[b,k]=d.useState(null),[h,_]=d.useState([]),[V,W]=d.useState([]),[E,P]=d.useState([]),[j,F]=d.useState([]),[m,A]=d.useState(null),[N,v]=d.useState([]),[D,C]=d.useState("substance"),[X,I]=d.useState([]),[i,R]=d.useState(null),[w,T]=d.useState([]),[p,S]=d.useState([]),[l,y]=d.useState("substance");d.useEffect(()=>{if(r!=null&&r.drug_substance){const e=r.drug_substance.filter(n=>{var u;return!((u=a.drug_substance)!=null&&u.some(o=>o.substance===n.substance))});M(e);const t=r.drug_substance.flatMap(n=>n.ds_manufacturers);U(t);const c=[...new Set(t.map(n=>n.substance_manufacturer))];I(c)}if(r!=null&&r.drug_product){const e=r.drug_product.filter(n=>{var u;return!((u=a.drug_product)!=null&&u.some(o=>o.drug_product===n.drug_product))});P(e);const t=r.drug_product.flatMap(n=>n.dp_manufacturers);W(t);const c=[...new Set(t.map(n=>n.product_manufacturer))];I(c)}},[r,a.drug_substance,a.drug_product]);const Y=e=>{if(!e){l==="substance"?(k(null),B([]),_([])):(A(null),F([]),v([]));return}const t=e.value;if(l==="substance"){const c=r.drug_substance.find(n=>n.id===t);k(c),B(c.ds_manufacturers),_([])}else{const c=r.drug_product.find(n=>n.id===t);A(c),F(c.dp_manufacturers),v([])}},Z=e=>{const t=e?e.value:null;if(R(t),t)if(l==="substance"){const n=r.drug_substance.filter(u=>u.ds_manufacturers.some(o=>o.substance_manufacturer===t)).filter(u=>{var o;return!((o=a.drug_substance)!=null&&o.some(K=>K.substance===u.substance))});T(n)}else{const n=r.drug_product.filter(u=>u.dp_manufacturers.some(o=>o.product_manufacturer===t)).filter(u=>{var o;return!((o=a.drug_product)!=null&&o.some(K=>K.product===u.product))});T(n)}else T([]);S([])},ee=e=>{if(e!=null&&e.some(t=>t.value==="select-all")){const t=w.map(c=>c.id);S(t)}else if(action==="deselect-option"&&(option==null?void 0:option.value)==="select-all")S([]);else{const t=e?e.filter(c=>c.value!=="select-all").map(c=>c.value):[];S(t)}},se=()=>{if(D==="substance")if(l==="substance"){if(!b||h.length===0){alert("Please select both a substance and at least one manufacturer");return}const e=x.filter(t=>h.includes(t.id));f({...a,drug_substance:[...a.drug_substance,{substance:b.substance,manufacturer:e.map(t=>t.substance_manufacturer),manufacturerIds:h}]}),M(t=>t.filter(c=>c.id!==b.id))}else{if(!m||N.length===0){alert("Please select both a product and at least one manufacturer");return}const e=j.filter(t=>N.includes(t.id));f({...a,drug_product:[...a.drug_product,{product:m.drug_product,manufacturer:e.map(t=>t.product_manufacturer),manufacturerIds:N}]}),P(t=>t.filter(c=>c.id!==m.id))}else if(i&&p.length>0)if(l==="substance"){const e=Q.filter(c=>c.substance_manufacturer===i).map(c=>c.id),t=p.map(c=>{const n=r.drug_substance.find(u=>u.id===c);return{substance:n.substance,manufacturer:[i],manufacturerIds:e.filter(u=>n.ds_manufacturers.some(o=>o.id===u))}});f({...a,drug_substance:[...a.drug_substance,...t]}),M($.filter(c=>!p.includes(c.id)))}else{const e=V.filter(c=>c.product_manufacturer===i).map(c=>c.id),t=p.map(c=>{const n=r.drug_product.find(u=>u.id===c);return{product:n.drug_product,manufacturer:[i],manufacturerIds:e.filter(u=>n.dp_manufacturers.some(o=>o.id===u))}});f({...a,drug_product:[...a.drug_product,...t]}),P(E.filter(c=>!p.includes(c.id)))}q()},q=()=>{D==="substance"?l==="substance"?(k(null),_([])):(A(null),v([])):(R(null),T([]),S([]))},z=(e,t)=>{f({...a,[t]:e})},te=()=>{q()},L=(e,t,c)=>{if(c==="substance"){const n=[...a.drug_substance];n.splice(e,1),f({...a,drug_substance:n});const u=r.drug_substance.find(o=>o.substance===t.substance);u&&M(o=>[...o,u])}else{const n=[...a.drug_product];n.splice(e,1),f({...a,drug_product:n});const u=r.drug_product.find(o=>o.product===t.product);u&&P(o=>[...o,u])}},ce=e=>{if(y(e),q(),e==="substance"&&(r!=null&&r.drug_substance)){const t=[...new Set(r.drug_substance.flatMap(c=>c.ds_manufacturers.map(n=>n.substance_manufacturer)))];I(t)}else if(e==="product"&&(r!=null&&r.drug_product)){const t=[...newSet(r.drug_product.flatMap(c=>c.dp_manufacturers.map(n=>n.product_manufacturer)))];I(t)}};return s.jsxs("div",{className:"flex-column","data-kt-stepper-element":"content",children:[s.jsxs("div",{className:"row mb-10",children:[s.jsxs("div",{className:"col-md-4 col-sm-12",children:[s.jsx("label",{className:"form-label",children:"Indication"}),s.jsx(g,{options:((r==null?void 0:r.indications)||[]).map(e=>({label:e.indication,value:e.indication})),name:"indication",onChange:e=>z(e,"indication"),className:"react-select-container",classNamePrefix:"react-select",placeholder:"",isClearable:!0,value:typeof a.indication=="object"&&a.indication!==null?a.indication:{label:a.indication,value:a.indication},menuPortalTarget:document.body,styles:{menuPortal:e=>({...e,zIndex:9999})}})]}),s.jsxs("div",{className:"col-md-4 col-sm-12",children:[s.jsx("label",{className:"form-label",children:"Dosage form"}),s.jsx(g,{options:((r==null?void 0:r.dosage_form)||[]).map(e=>({label:e.form,value:e.form})),name:"dosage_form",onChange:e=>z(e,"dosage_form"),className:"react-select-container",classNamePrefix:"react-select",placeholder:"",isClearable:!0,value:typeof a.dosage_form=="object"&&a.dosage_form!==null?a.dosage_form:{label:a.dosage_form,value:a.dosage_form},menuPortalTarget:document.body,styles:{menuPortal:e=>({...e,zIndex:9999})}})]}),s.jsxs("div",{className:"col-md-4 col-sm-12",children:[s.jsx("label",{className:"form-label",children:"Excipient"}),s.jsx(g,{options:((r==null?void 0:r.excipients)||[]).map(e=>({label:e.excipient,value:e.excipient})),name:"excipient",onChange:e=>z(e,"excipient"),className:"react-select-container",classNamePrefix:"react-select",placeholder:"",isClearable:!0,isMulti:!0,value:a.excipient,menuPortalTarget:document.body,styles:{menuPortal:e=>({...e,zIndex:9999})}})]})]}),s.jsx("div",{children:s.jsxs(ne,{className:"nav-line-tabs nav-stretch fs-5 fw-bold mb-5",defaultActiveKey:"substance",id:"drug-tabs",activeKey:l,onSelect:ce,children:[s.jsx(J,{eventKey:"substance",title:s.jsx("span",{className:"d-flex align-items-center",children:"Drug Substance"}),children:s.jsxs("div",{children:[s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[s.jsx("button",{type:"button",className:"btn btn-sm btn-primary","data-bs-toggle":"modal","data-bs-target":"#kt_modal_drug_item",onClick:()=>{C("substance"),y("substance")},children:"Add By Substance"}),s.jsx("button",{type:"button",className:"btn btn-sm btn-primary ms-2","data-bs-toggle":"modal","data-bs-target":"#kt_modal_drug_item",onClick:()=>{C("manufacturer"),y("substance")},children:"Add By Manufacturer"})]}),s.jsxs("table",{className:"table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4",children:[s.jsx("thead",{className:"fw-bold",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-center",children:"Drug Substance"}),s.jsx("th",{className:"text-center",children:"Drug Substance Manufacturer"}),s.jsx("th",{className:"text-center",children:"Actions"})]})}),s.jsx("tbody",{children:(O=a.drug_substance)==null?void 0:O.map((e,t)=>s.jsxs("tr",{children:[s.jsx("td",{className:"text-center",children:e.substance}),s.jsx("td",{className:"text-center",children:e.manufacturer.map((c,n)=>s.jsx("div",{children:c},n))}),s.jsx("td",{className:"text-center",children:s.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>L(t,e,"substance"),children:s.jsx(H,{iconName:"trash-square",className:"fs-2"})})})]},t))})]})]})}),s.jsx(J,{eventKey:"product",title:s.jsx("span",{className:"d-flex align-items-center",children:"Drug Product"}),children:s.jsxs("div",{children:[s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[s.jsx("button",{type:"button",className:"btn btn-sm btn-primary","data-bs-toggle":"modal","data-bs-target":"#kt_modal_drug_item",onClick:()=>{C("substance"),y("product")},children:"Add By Product"}),s.jsx("button",{type:"button",className:"btn btn-sm btn-primary ms-2","data-bs-toggle":"modal","data-bs-target":"#kt_modal_drug_item",onClick:()=>{C("manufacturer"),y("product")},children:"Add By Manufacturer"})]}),s.jsxs("table",{className:"table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4",children:[s.jsx("thead",{className:"fw-bold",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-center",children:"Drug Product"}),s.jsx("th",{className:"text-center",children:"Drug Product Manufacturer"}),s.jsx("th",{className:"text-center",children:"Actions"})]})}),s.jsx("tbody",{children:(G=a.drug_product)==null?void 0:G.map((e,t)=>s.jsxs("tr",{children:[s.jsx("td",{className:"text-center",children:e.product}),s.jsx("td",{className:"text-center",children:e.manufacturer.map((c,n)=>s.jsx("div",{children:c},n))}),s.jsx("td",{className:"text-center",children:s.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>L(t,e,"product"),children:s.jsx(H,{iconName:"trash-square",className:"fs-2"})})})]},t))})]})]})})]})}),s.jsx("div",{className:"modal fade",id:"kt_modal_drug_item","aria-hidden":"true",children:s.jsx("div",{className:"modal-dialog modal-m",children:s.jsxs("div",{className:"modal-content rounded",children:[s.jsx("div",{className:"modal-header justify-content-end border-0 pb-0",children:s.jsx("div",{className:"btn btn-sm btn-icon btn-active-color-primary","data-bs-dismiss":"modal"})}),s.jsxs("div",{className:"modal-body pt-0 pb-15 px-5 px-xl-20",children:[D==="substance"?s.jsxs(s.Fragment,{children:[s.jsx(g,{options:(l==="substance"?$:E).map(e=>({label:l==="substance"?e.substance:e.drug_product,value:e.id})),onChange:Y,className:"react-select-container",classNamePrefix:"react-select",placeholder:`Search for ${l==="substance"?"drug substance":"drug product"}`,value:(l==="substance"?b:m)?{label:l==="substance"?b.substance:m.drug_product,value:l==="substance"?b.id:m.id}:null,menuPortalTarget:document.body,styles:{menuPortal:e=>({...e,zIndex:9999})}}),s.jsx(g,{options:[{label:"Select All Manufacturers",value:"select-all",isDisabled:(l==="substance"?x:j).length===0},...(l==="substance"?x:j).map(e=>({label:l==="substance"?e.substance_manufacturer:e.product_manufacturer,value:e.id}))],isMulti:!0,onChange:(e,t)=>{var c;if(((c=t.option)==null?void 0:c.value)==="select-all"){const n=(l==="substance"?x:j).map(u=>u.id);l==="substance"?_(n):v(n)}else{const n=e?e.filter(u=>u.value!=="select-all").map(u=>u.value):[];l==="substance"?_(n):v(n)}},value:(l==="substance"?x:j).filter(e=>(l==="substance"?h:N).includes(e.id)).map(e=>({label:l==="substance"?e.substance_manufacturer:e.product_manufacturer,value:e.id})),isDisabled:l==="substance"?!b:!m,placeholder:"Select manufacturers",className:"react-select-container mt-3",classNamePrefix:"react-select"})]}):s.jsxs(s.Fragment,{children:[s.jsx(g,{options:(X||[]).map(e=>({label:e,value:e})),onChange:Z,className:"react-select-container",classNamePrefix:"react-select",placeholder:`Search for ${l==="substance"?"substance":"product"} manufacturer`,value:i?{label:i,value:i}:null,menuPortalTarget:document.body,styles:{menuPortal:e=>({...e,zIndex:9999})}}),s.jsx(g,{options:[{label:`Select All ${l==="substance"?"Substances":"Products"}`,value:"select-all",isDisabled:w.length===0},...(w||[]).map(e=>({label:l==="substance"?e.substance:e.drug_product,value:e.id}))],isMulti:!0,onChange:ee,className:"react-select-container mt-3",classNamePrefix:"react-select",placeholder:`Select ${l==="substance"?"substances":"products"}`,isDisabled:!i,value:(w||[]).filter(e=>p.includes(e.id)).map(e=>({label:l==="substance"?e.substance:e.drug_product,value:e.id})),menuPortalTarget:document.body,styles:{menuPortal:e=>({...e,zIndex:9999})}})]}),s.jsxs("div",{className:"d-flex flex-center flex-row-fluid pt-12",children:[s.jsx("button",{type:"reset",className:"btn btn-light me-3","data-bs-dismiss":"modal",onClick:te,children:"Cancel"}),s.jsx("button",{type:"button",className:"btn btn-primary","data-bs-dismiss":"modal",onClick:se,disabled:D==="substance"?l==="substance"?!b||h.length===0:!m||N.length===0:!i||p.length===0,children:"Save"})]})]})]})})})]})};export{de as P};
